# 单元格详情页面设计 (Cell Detail Page)

点击任务矩阵中的单元格进入详情页，是实现“白盒化 AI”最关键的交互。为了保证科学家工作的连续性与“心流体验”，我们将原先的四个独立页面重构为**垂直流式页面 (Vertical Progressive Flow)**。

核心设计理念：**渐进式展开 (Progressive Disclosure)**。用户无需在页面间频繁跳转，而是像完成一份长试卷一样，顺流而下，上一环节完成后自动展开下一环节。

---

## 1. 页面整体架构

*   **顶部导航栏** (始终悬浮)：
    *   显示当前章节信息（如：Chapter 2. Precision & Accuracy）。
    *   **阶段锚点**：P1 (Data) -> P2 (Math) -> P3 (Draft) -> P4 (Review)。点击可快速定位到对应区域。
    *   **状态指示灯**：每个阶段旁有红/绿灯，实时显示合规状态。

*   **主体区域**：单一长滚动视图，分为四个折叠面板 (Collapsible Panels)。

---

## 2. P1 区域：数据映射 (Data Mapping)

**定位**：定义数据的来源 (The "Grounding" Layer)。

*   **默认状态**：展开。
*   **布局**：
    *   **左侧：数据契约表**。列出本章节需要的所有变量（如 `LLOQ_Mean`, `IntraBatch_CV`）。
    *   **右侧：源文件预览窗**。显示关联的 Excel/Word 片段。
*   **交互逻辑**：
    *   用户确认左侧每个字段的来源无误。
    *   当所有必须字段（Mandatory Fields）均就绪（Green Check）后，**P1 区域自动折叠为“摘要模式”，P2 区域自动展开**。
    *   *摘要模式*：仅显示“来源于 3 个文件：batch_01.xlsx, protocol_v2.pdf... (点击展开)”。

---

## 3. P2 区域：事实核对 (Fact-Check)

**定位**：隔离沙箱中的逻辑计算 (The "Logic" Layer)。

*   **默认状态**：折叠（待 P1 完成后展开）。
*   **布局**：**Hebbia 风格结构化表格**。
    *   列：变量名 | 计算逻辑(公式) | 计算结果 | SOP阈值 | 判定。
*   **核心功能**：
    *   **异常高亮**：超标数据（如 CV > 15%）整行标红。用户必须点击“确认异常”并填写理由，或者返回 P1 修改源数据。
    *   **微虚拟机验证**：点击任何数字，在下方展开 `Firecracker MicroVM` 的执行日志片段，证明该数字的计算过程。
*   **流转逻辑**：
    *   当所有数据点被确认（或异常已被合理解释）后，用户点击“锁定事实”。
    *   **P2 区域折叠，P3 区域自动展开**。

---

## 4. P3 区域：文稿生成与对比 (Drafting & Diff)

**定位**：将事实转化为文字 (The "Narrative" Layer)。

*   **布局**：左侧 P2 事实数据（只读引用） | 右侧 文本编辑器。
*   **核心功能 - 智能对比 (Smart Diff)**：
    *   AI 生成初稿。
    *   **数值防篡改**：如果用户手动修改了文中的数字，系统会实时比对 P2 的事实库。
    *   **Diff 视图**：若用户修改了描述（例如将“符合要求”改为“基本符合”），系统会在侧边显示**“推荐 vs 当前”**的对比，并提示该修改是否偏离了 SOP 范例。
*   **流转逻辑**：
    *   定稿后，点击“生成预览”。进入 P4 模式。

---

## 5. P4 区域：全屏预览与签署 (Review & Sign-off)

**定位**：最终合规把关。

*   **交互**：点击 P3 的完成按钮后，页面进入**“全屏预览模式”**（覆盖掉 P1/P2/P3 的滚动视图）。
*   **核心功能**：
    *   **Word 级渲染**：完全还原打印效果。
    *   **溯源透视镜 (Lineage Lens)**：鼠标悬停在任何段落或数字上，会浮现一个半透明层，显示：
        *   -> 引用了 P3 的哪段文字
        *   -> 基于 P2 的哪个计算结果
        *   -> 来自 P1 的哪个 Excel 单元格
    *   **电子签名**：底部固定栏输入密码签署。签署后，整个单元格状态变为“Locked”。

---

## 总结优化点

1.  **心流保持**：科学家不需要在 4 个页面间切来切去，思维是连续的（数据 -> 算 -> 写 -> 审）。
2.  **上下文保留**：在写 P3 时，只需向上滚动一点就能看到 P2 的计算结果，无需开新窗口。
3.  **空间效率**：利用“自动折叠”机制，确保屏幕主要区域始终留给当前工作阶段。
